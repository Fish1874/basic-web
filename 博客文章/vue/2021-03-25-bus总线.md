## 跨级通信

> 原理就是通过在vue根实例上添加一个bus属性，所有的子组件都继承这个bus属性。
>
> 【注】在组件销毁的时候要取消监听！



1. 在入口文件定义bus！

   ```javascript
   // 方式一
   var EventBus = new Vue();
   Object.defineProperties(Vue.prototype, {
     $bus: {
       get: function () {
         return EventBus
       }
     }
   })
   
   // 方式二
   Vue.prototype.bus = new Vue();
   ```

   


2. **$emit** 分发事件

   ```javascript
   methods: {
     todo: function () {
       this.$bus.$emit('todoSth', params);  //params是传递的参数
       //...
     }
   }
   ```



3. **$on** 监听事件

   【注】接收事件时**$on**要在 `created`生命周期内获取！mounted是获取不到的。

   ```javascript
   // 其它组件可以监听到 事件todoSth
   created() {
     this.$bus.$on('todoSth', (params) => {  //获取传递的参数并进行操作
         //todo something
     })
   },
   
   // 最好在组件销毁前，清除事件监听
   beforeDestroy () {
     this.$bus.$off('todoSth');
   },
   ```



- 如果需要监听多个组件，只需要更改 **bus** 的 **eventName**:

  ```javascript
  created() {
    this.$bus.$on('firstTodo', this.firstTodo);
    this.$bus.$on('secondTodo', this.secondTodo);
  },
  
  // 清除事件监听
  beforeDestroy () {
    this.$bus.$off('firstTodo', this.firstTodo);
    this.$bus.$off('secondTodo', this.secondTodo);
  },
  ```



【注】记得要在销毁时，清除事件的监听！

- 因为bus的自定义事件是基于“发布订阅”模式，每当我们在页面离开再进入、就会重新触发一次**$on**，所以记得 `销毁时`内取消监听！